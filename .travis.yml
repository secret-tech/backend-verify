sudo: required
services:
- docker
before_install:
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- chmod ugo+x ./build.sh
script:
- docker-compose build verify
- docker-compose run --rm verify sh -c "yarn && yarn test"
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ];  then echo "production"; elif ["$TRAVIS_BRANCH"
  == "develop"]; then echo "stage"; else echo "dev-$(git rev-parse --short HEAD)"
  ; fi`
- "./build.sh $TAG"
env:
  global:
  - secure: iav2owjHUd8+tPlyX+mzHmVayZJoGilep3A8/EvJIvb1t6Do39tQU4lSqd0LhJxg3mQh6kV2oBk0OZO8LInSD/XrGn1afuqWdPCNd02GbdqyBqZ5NiazpzL9mpiL8tAMQsfBtSe5sAkg47e9URzoUpXLNhg/6VD3iPqwBGOJ1eLvxiziotVeKlB+RweEUUCb6x/Mo4iEY0BRI+ciYW1pNXtKwHGYg35lxbG5vjJVl4p9LN0+J6D5gc9COHQNSqZDA3Y6CY3/Nxr6F/pHqgl5VycRXaGg4PcmnnB7RfaSgp/10x6pN1VB2pUcIj6d9JmdNKUPswX/E6b068IIuCHpuVw5BKKD/qGzLZufR+dLViFQjkZb9ZNXNbWpbyEH7JGewc7hkOPFDC9TW5Mn64SLRzs9IMzN2eEL3pkW0Tg36i1N/NTevZnxIsRGbRyLBYn4VItVe5eHQOheBTPmJ+Txb82cdPLhSv0WjvQtp25tAy34tfQVAoZ8Tiq07oTTFM41UTJhVLQCKp7bEO0MNUQzfXjpPZWyFsnyhn9ZBy9MJum4Ud41tmvedYVzDjzAKnnNXJlMpPdwb3nj2czYly2Man9wRbkSLKa7dnv08v2Y5I+UuVUZ7sgtjKH9OSghhvyjNvtR70YX6J6nBNPGnOZwNAuCM7Rq0JYuoRzh8fkWtUY=
  - secure: gtld4jpjYEo+gfOOtwp89zTFPfHx6A42+NGAB+RyABgZqDdqqyBKSo/fjsIgy4etSiZ6yZhoqrAjzon1oe6YJsHInDpnuPzpSdnpUg6YsJFusHf+mPEKg/dPVS4dPA/bjPYcCgK7Cys+YUKeMKjUqyufv+duufjL89TOdpTMvhqnepHc9N/R75AX7kKR4f1kGR1ce3m48QAidgq/m5j4u7Nkl+5qvmtyOd9SULyiGFxvbckBGzhXRpmlIXakqZa90ui3pirfeJHq5S2s6x9hrV6i3MYWxsRmeoEOpCT40W/wEZwVvMo3zTAVmZLsl9QvMhdtjwYKBgRC0dd3gFLYV8szGsxU9qDnOaCPleawE3SZ/+4WvHPxpN/bzQdRDFJLexhMhydmZnEWg2DpFyow6Oz4f/ViPqH3qySkwEUX5EBmX1pTk5nFpdtzfTN3FCUb3sYSlEbBopsU8KqA5hRnflB5b1JwoN4vg/pUBt/8f2Fi8lbxtkB9NbHmQvSufVAnluCOFlC5AkzHQZP3xSL3+7vIYVPHKGru6qqwa2yZXvJdLNspZO+WN6NIRK14NpaptPUmmo+fGpjUdyKXo5a/WH/NAGGcUPT1N0fVOqwbE2+K8PJVwNN+GoCv1KUS/U6C3AQlb0vbv8wqAL0Ud9pzkD9PRs7O+Fpmv/Hmxfyz86o=
notifications:
  slack:
    secure: XkpxurHZJxQuhwnAnQvhWEIIOJGLywHQgW+DLjNCxwo4nM82IbsTY4a6JicsO0jkzdkxX1yk5W4pB7BbBeiuwLC72gRZGmD2AY1EZThsPsVtv6aMi6VXgYyiAgAv2gV8Dv7P8MsHnSiqkwuIwHnveu3QA2yTjnsDeyfsMWRSdH1C4kb6EpsxMV2LE0KxEtM88Vney2Qm82LhSyB0x9c2ExVsQOOtseKMaeA2KXgm0b2wJLmYgtapk8eZszC9fao4ANkCfVvipt78C4eJvska/0KGem36k7ZKZm+Qgk8SUWU1YHALOznsCzuVKErwuaurDxgFcImxQgGdQ2+ygHQPqdh16i0kmEu/TPb1IxKSf8a2NBUfoSutneDmrJAD9peEFnXvAA2D8RICtLMkxprXgPgncEwRlPdfpMI/F7xv/+1u2xWjUrSME2IjHFUACLbdnrKH6VSnCrXZmKTLC0+nsujAEPELqSWfJ3xzNReKf6XqCADVSm4rwvbaV9E4YlFNiPKnQTpV3ELe0hEcouI4kKAYWR59g6QLjYacVvosK2Gv0q8c9jo67X1Tf3E4gOiN7Ai3qjKSwlE3QXaQzlHPEzzje0ImdT39F2dCTdydTgh6PX23B6IIfHwZE1PGn8oHwtpZ/kZ9K739W7TwAkbW6Bv94uXrGTOlQGn0iMBZIAY=
